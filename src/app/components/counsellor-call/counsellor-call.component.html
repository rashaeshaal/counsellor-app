
<ion-content class="call-container" [ngClass]="{'connecting': isConnecting, 'connected': isConnected, 'incoming': hasIncomingCall}">
  <!-- Call Header -->
  <div class="call-header">
    <div class="client-info">
      <div class="call-details">
        <h2>{{ clientName }}</h2>
        <p class="call-status" [ngClass]="callState" aria-live="polite">{{ callStateText }}</p>
      </div>
    </div>
    
    <!-- Call Timer -->
    <div class="call-timer" *ngIf="isConnected" aria-live="polite">
      <ion-icon name="time-outline" aria-hidden="true"></ion-icon>
      <span>{{ callDuration }}</span>
    </div>
  </div>

  <!-- Incoming Call Notification -->
  <div class="incoming-call-notification" 
       *ngIf="hasIncomingCall && !isConnected && !isConnecting" 
       aria-live="assertive">
    <div class="wave-container">
      <div class="wave wave1"></div>
      <div class="wave wave2"></div>
      <div class="wave wave3"></div>
      <div class="wave wave4"></div>
      <div class="wave wave5"></div>
    </div>
    <p class="incoming-call-text">Incoming call from {{ clientName }}</p>
    
    <!-- Optimized Call Control Buttons for Mobile -->
    <div class="call-controls incoming-controls">
      <ion-button 
        fill="solid" 
        color="success" 
        (click)="acceptCall()"
        [disabled]="isActionInProgress"
        class="mobile-optimized-btn accept-btn"
        size="large"
        aria-label="Accept incoming call">
        <ion-icon name="call-outline" slot="start" aria-hidden="true"></ion-icon>
        <span *ngIf="!isActionInProgress">Accept</span>
        <ion-spinner *ngIf="isActionInProgress" name="crescent"></ion-spinner>
      </ion-button>
      
      <ion-button 
        fill="solid" 
        color="danger" 
        (click)="rejectCall()"
        [disabled]="isActionInProgress"
        class="mobile-optimized-btn reject-btn"
        size="large"
        aria-label="Reject incoming call">
        <ion-icon name="close-outline" slot="start" aria-hidden="true"></ion-icon>
        <span *ngIf="!isActionInProgress">Reject</span>
        <ion-spinner *ngIf="isActionInProgress" name="crescent"></ion-spinner>
      </ion-button>
    </div>
  </div>

  <!-- Audio Visualizer -->
  <div class="audio-visualizer" *ngIf="isConnected" aria-live="polite">
    <div class="wave-container">
      <div class="wave wave1" [class.active]="!isMuted"></div>
      <div class="wave wave2" [class.active]="!isMuted"></div>
      <div class="wave wave3" [class.active]="!isMuted"></div>
      <div class="wave wave4" [class.active]="!isMuted"></div>
      <div class="wave wave5" [class.active]="!isMuted"></div>
    </div>
    <p class="audio-status">Audio Call in Progress</p>
  </div>

  <!-- Hidden Audio Elements -->
  <audio #localAudio autoplay muted aria-hidden="true"></audio>
  <audio #remoteAudio autoplay aria-hidden="true"></audio>

  <!-- Active Call Controls -->
  <div class="call-controls active-controls" *ngIf="isConnected">
    <!-- Audio Toggle -->
    <ion-button 
      fill="solid" 
      [color]="isAudioEnabled ? 'medium' : 'danger'"
      (click)="toggleAudio()"
      class="mobile-optimized-btn control-btn"
      size="large"
      [attr.aria-label]="isAudioEnabled ? 'Mute microphone' : 'Unmute microphone'">
      <ion-icon [name]="isAudioEnabled ? 'mic' : 'mic-off'" aria-hidden="true"></ion-icon>
    </ion-button>

    <!-- End Call -->
    <ion-button 
      fill="solid" 
      color="danger" 
      (click)="endCall()"
      class="mobile-optimized-btn end-call-btn"
      size="large"
      aria-label="End call">
      <ion-icon name="call" class="end-call-icon" aria-hidden="true"></ion-icon>
    </ion-button>
  </div>

  <!-- Connection Status -->
  <div class="connection-status" 
       *ngIf="isConnecting && !hasIncomingCall" 
       aria-live="assertive">
    <ion-spinner name="crescent" aria-hidden="true"></ion-spinner>
    <p>{{ callStateText }}</p>
  </div>
</ion-content>
