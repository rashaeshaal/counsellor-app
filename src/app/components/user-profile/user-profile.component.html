<ion-page>
<ion-content class="bg-white">
  <div class="relative flex size-full min-h-screen flex-col bg-white justify-between group/design-root overflow-x-hidden" style='font-family: Lexend, "Noto Sans", sans-serif;'>
    <!-- Background Decoration for Floating Shapes -->
    <div class="bg-decoration">
      <div class="floating-shape shape-1"></div>
      <div class="floating-shape shape-2"></div>
      <div class="floating-shape shape-3"></div>
    </div>

    <div>
      <!-- Enhanced Header -->
      <div class="header-enhanced">
     
        <div class="header-spacer"></div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading profile...</div>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-container">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-text">{{ error }}</div>
      </div>

      <!-- View Mode - Enhanced -->
      <div *ngIf="user && !editMode && !loading" class="profile-container">
        <div class="profile-view-enhanced">
          <div class="profile-header-section">
            <div class="profile-image-container">
              <div
                class="profile-image-enhanced"
                [style.background-image]="user.profile_photo ? 'url(' + user.profile_photo + ')' : 'url(https://lh3.googleusercontent.com/aida-public/AB6AXuBNDNTHkCT_irRd0FOe54SCnHKSZawgOY75WtbEL6QKFrGAMH3Vny4GmacW4ZaKS5mNB4ZY5H1IlQZod4JNE6rRc8ILRpyXgi5452cyrFdSVUk2T4aZXirDFAd4ZAxGrdLnMFP03zX5vZl_eLAd54j3bj7rklm7oPqI0Ow0xXvpT685j44gBg_NuTEet7oOtoOFOrVCfO8JaL0aKoHLdMxCosCRTdhQaJiXgeqPCKBKfN8SLreGWhOK5cpeyA1eTE42vF1D-tiIOV3_)'"
              ></div>
            </div>
            <!-- Moved Edit Button Below Profile Pic Container -->
            <button
              type="button"
              class="edit-btn-enhanced"
              (click)="openEditProfileModal()"
              aria-label="Edit profile"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                <path d="M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.69Z"></path>
              </svg>
            </button>
            
            <div class="profile-info-section">
              <div class="profile-name-enhanced">{{ user.name || 'No name set' }}</div>
              <div class="profile-age-enhanced">{{ user.age ? user.age + ' years old' : 'Age not set' }}</div>
            </div>
          </div>

          <!-- Enhanced Contact Details Grid -->
          <div class="contact-details-grid">
            <div class="contact-item-enhanced">
              <div class="contact-label-enhanced">Email</div>
              <div class="contact-value-enhanced">{{ user.email || 'Email not set' }}</div>
            </div>
            
            <div class="contact-item-enhanced">
              <div class="contact-label-enhanced">Phone</div>
              <div class="contact-value-enhanced">{{ user.phone_number || 'Phone not set' }}</div>
            </div>
            
            <div class="contact-item-enhanced contact-full-width">
              <div class="contact-label-enhanced">Role</div>
              <div class="contact-value-enhanced">{{ user.user_role || 'Role not set' }}</div>
            </div>
            
            <div class="contact-item-enhanced">
              <div class="contact-label-enhanced">Sessions</div>
              <div class="contact-value-enhanced">{{ user.total_sessions || 0 }} completed</div>
            </div>
            
            <div class="contact-item-enhanced">
              <div class="contact-label-enhanced">Member Since</div>
              <div class="contact-value-enhanced">Jan 2024</div>
            </div>

            <!-- Logout Button -->
            <div class="contact-item-enhanced contact-full-width">
              <button class="logout-button" (click)="logout()">
                <ion-icon name="log-out-outline"></ion-icon>
                <span>Logout</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Mode - Enhanced -->
      <div *ngIf="editMode && editableUser && !loading" class="profile-container">
        <div class="profile-edit-enhanced">
          <!-- Photo Upload Section -->
          <div class="photo-upload-section">
            <div class="upload-container">
              <div
                class="profile-image-enhanced edit-mode"
                [style.background-image]="editableUser.profile_photo ? 'url(' + editableUser.profile_photo + ')' : 'url(https://lh3.googleusercontent.com/aida-public/AB6AXuBNDNTHkCT_irRd0FOe54SCnHKSZawgOY75WtbEL6QKFrGAMH3Vny4GmacW4ZaKS5mNB4ZY5H1IlQZod4JNE6rRc8ILRpyXgi5452cyrFdSVUk2T4aZXirDFAd4ZAxGrdLnMFP03zX5vZl_eLAd54j3bj7rklm7oPqI0Ow0xXvpT685j44gBg_NuTEet7oOtoOFOrVCfO8JaL0aKoHLdMxCosCRTdhQaJiXgeqPCKBKfN8SLreGWhOK5cpeyA1eTE42vF1D-tiIOV3_)'"
              >
                <div class="upload-overlay">
                  <div class="upload-icon">üì∑</div>
                </div>
                <input
                  type="file"
                  (change)="onFileSelected($event)"
                  accept="image/*"
                  class="file-input-hidden"
                />
              </div>
            </div>
            <div class="upload-hint-text">Tap photo to change</div>
          </div>

          <!-- Enhanced Form -->
          <form (ngSubmit)="updateProfile()" #profileForm="ngForm" novalidate class="enhanced-form">
            <div class="form-grid-enhanced">
              <!-- Name and Age Row -->
              <div class="form-row-enhanced">
                <div class="form-group-enhanced">
                  <label for="name" class="form-label-enhanced">Name</label>
                  <input
                    id="name"
                    type="text"
                    [(ngModel)]="editableUser.name"
                    name="name"
                    required
                    class="form-input-enhanced"
                    placeholder="Enter your full name"
                  />
                </div>
                <div class="form-group-enhanced">
                  <label for="age" class="form-label-enhanced">Age</label>
                  <input
                    id="age"
                    type="number"
                    [(ngModel)]="editableUser.age"
                    name="age"
                    required
                    class="form-input-enhanced"
                    placeholder="Age"
                    min="1"
                    max="120"
                  />
                </div>
              </div>

              <!-- Email Full Width -->
              <div class="form-group-enhanced form-full-width">
                <label for="email" class="form-label-enhanced">Email</label>
                <input
                  id="email"
                  type="email"
                  [(ngModel)]="editableUser.email"
                  name="email"
                  required
                  class="form-input-enhanced"
                  placeholder="your.email@example.com"
                />
              </div>

              <!-- Phone Full Width -->
              <div class="form-group-enhanced form-full-width">
                <label for="phone" class="form-label-enhanced">Phone Number</label>
                <input
                  id="phone"
                  type="tel"
                  [(ngModel)]="editableUser.phone_number"
                  name="phone_number"
                  class="form-input-enhanced"
                  placeholder="+1 234 567 8900"
                />
              </div>
            </div>

            <!-- Enhanced Action Buttons -->
            <div class="action-buttons-enhanced">
              <button
                type="button"
                (click)="cancelEdit()"
                class="btn-enhanced btn-cancel-enhanced"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z"/>
                </svg>
                Cancel
              </button>
              <button
                type="submit"
                [disabled]="profileForm.invalid"
                class="btn-enhanced btn-save-enhanced"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M21 7v12q0 .825-.588 1.413Q19.825 21 19 21H5q-.825 0-1.413-.587Q3 19.825 3 19V5q0-.825.587-1.413Q4.175 3 5 3h12l4 4ZM17 19V12H7v7h10Zm-8-9h6V7H9v3Zm8 9V12H7v7h10Z"/>
                </svg>
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</ion-content>
</ion-page>
