
<ion-content class="call-container" [ngClass]="{'connecting': isConnecting, 'connected': isConnected, 'ringing': isRinging}">
  <!-- Call Header -->
  <div class="call-header">
    <div class="counsellor-info">
      <div class="call-details">
        <h2>{{ counsellorName }}</h2>
        <p class="call-status" [ngClass]="callState">{{ callStateText }}</p>
      </div>
    </div>
    
    <!-- Call Timer -->
    <div class="call-timer" *ngIf="isConnected" aria-live="polite">
      <ion-icon name="time-outline" aria-hidden="true"></ion-icon>
      <span>{{ callDuration }}</span>
    </div>
  </div>

  <!-- Ringing Indicator -->
  <div class="ringing-indicator" 
       *ngIf="isRinging && !isConnected && !isConnecting" 
       aria-live="assertive">
    <div class="wave-container">
      <div class="wave wave1"></div>
      <div class="wave wave2"></div>
      <div class="wave wave3"></div>
      <div class="wave wave4"></div>
      <div class="wave wave5"></div>
    </div>
    <p class="ringing-text">Calling {{ counsellorName }}...</p>
  </div>

  <!-- Audio Visualizer -->
  <div class="audio-visualizer" *ngIf="isConnected" aria-live="polite">
    <div class="wave-container">
      <div class="wave wave1" [class.active]="!isMuted"></div>
      <div class="wave wave2" [class.active]="!isMuted"></div>
      <div class="wave wave3" [class.active]="!isMuted"></div>
      <div class="wave wave4" [class.active]="!isMuted"></div>
      <div class="wave wave5" [class.active]="!isMuted"></div>
    </div>
    <p class="audio-status">Audio Call in Progress</p>
  </div>

  <!-- Hidden Audio Elements -->
  <audio #localAudio autoplay muted aria-hidden="true"></audio>
  <audio #remoteAudio autoplay aria-hidden="true"></audio>

  <!-- Call Controls -->
  <div class="call-controls">
    <!-- Audio Control -->
    <ion-button 
      fill="solid" 
      [color]="isAudioEnabled ? 'medium' : 'danger'"
      (click)="toggleAudio()"
      class="mobile-optimized-btn control-btn"
      size="large"
      [attr.aria-label]="isAudioEnabled ? 'Mute microphone' : 'Unmute microphone'">
      <ion-icon [name]="isAudioEnabled ? 'mic' : 'mic-off'" aria-hidden="true"></ion-icon>
    </ion-button>

    <!-- End/Cancel Call -->
    <ion-button 
      fill="solid"
      color="danger"
      (click)="isRinging ? cancelCall() : endCall()"
      [disabled]="isActionInProgress"
      class="mobile-optimized-btn end-call-btn"
      size="large"
      [attr.aria-label]="isRinging ? 'Cancel Call' : 'End Call'">
      <ion-icon name="call" class="end-call-icon" aria-hidden="true"></ion-icon>
      <ion-spinner *ngIf="isActionInProgress" name="crescent"></ion-spinner>
    </ion-button>
  </div>

  <!-- Connection Status -->
  <div class="connection-status" *ngIf="isConnecting" aria-live="assertive">
    <ion-spinner name="crescent" aria-hidden="true"></ion-spinner>
    <p>{{ callStateText }}</p>
  </div>
</ion-content>
