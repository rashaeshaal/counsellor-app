<ion-content [fullscreen]="true">
  <!-- Background Decoration -->
  <div class="bg-decoration-enhanced">
    <div class="floating-shape-enhanced shape-1-enhanced"></div>
    <div class="floating-shape-enhanced shape-2-enhanced"></div>
    <div class="floating-shape-enhanced shape-3-enhanced"></div>
  </div>

  <div class="form-container-enhanced">
    <!-- Enhanced Header -->
    <div class="form-header-enhanced">
      <div class="header-icon-enhanced">ðŸŽ¯</div>
      <h2 class="form-title-enhanced">Join Our Team</h2>
      <p class="form-subtitle-enhanced">Create your counsellor profile</p>
    </div>

    <form [formGroup]="counsellorForm" (ngSubmit)="onSubmit()" class="form-enhanced" novalidate>
      <!-- Enhanced Profile Photo Section -->
      <div class="profile-section-enhanced">
        <div class="photo-container-enhanced" (click)="selectPhoto()">
          <div class="photo-preview-enhanced">
            <img [src]="profilePhotoUrl || 'assets/images/default-avatar.png'" alt="Profile preview" />
            <div class="photo-overlay-enhanced">
              <div class="camera-icon-enhanced">ðŸ“·</div>
            </div>
            <div class="photo-upload-btn-enhanced">
              <ion-icon name="camera-outline"></ion-icon>
            </div>
          </div>
          <input type="file" #photoInput class="photo-input-enhanced" accept="image/*" (change)="onPhotoSelected($event)" />
        </div>
        <p class="photo-text-enhanced">Upload a professional photo</p>
      </div>

      <!-- Enhanced Form Grid -->
      <div class="form-grid-enhanced">
        <!-- Name and DOB Row -->
        <div class="form-row-enhanced">
          <div class="form-group-enhanced">
            <label class="form-label-enhanced">Full Name *</label>
            <ion-item class="form-item-enhanced" [class.ion-invalid]="counsellorForm.get('name')?.invalid && counsellorForm.get('name')?.touched">
              <ion-input formControlName="name" type="text" placeholder="Enter your full name" required></ion-input>
            </ion-item>
            <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('name')?.hasError('required') && counsellorForm.get('name')?.touched">
              Name is required
            </ion-note>
            <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('name')?.hasError('maxlength') && counsellorForm.get('name')?.touched">
              Name cannot exceed 255 characters
            </ion-note>
          </div>

          <div class="form-group-enhanced">
            <label class="form-label-enhanced">Date of Birth *</label>
            <ion-item class="form-item-enhanced date-picker-enhanced" (click)="openDobPicker()">
              <ion-text *ngIf="counsellorForm.controls['dob'].value" class="date-value-enhanced">
                {{ counsellorForm.controls['dob'].value | date:'MM/dd/yyyy' }}
              </ion-text>
              <ion-text *ngIf="!counsellorForm.controls['dob'].value" class="date-placeholder-enhanced">
                Select date of birth
              </ion-text>
              <ion-icon slot="end" name="calendar-outline" class="date-icon-enhanced"></ion-icon>
            </ion-item>
            <ion-modal #dobModal [keepContentsMounted]="true" class="datetime-modal-enhanced">
              <ng-template>
                <ion-datetime
                  id="dobPicker"
                  displayFormat="MM/DD/YYYY"
                  [max]="maxDate"
                  (ionChange)="onDateSelected($event)"
                  [value]="counsellorForm.controls['dob'].value"
                ></ion-datetime>
              </ng-template>
            </ion-modal>
          </div>
        </div>

        <!-- Email Full Width -->
        <div class="form-group-enhanced form-full-width">
          <label class="form-label-enhanced">Email Address *</label>
          <ion-item class="form-item-enhanced" [class.ion-invalid]="counsellorForm.get('email')?.invalid && counsellorForm.get('email')?.touched">
            <ion-input formControlName="email" type="email" placeholder="Enter your email address" required></ion-input>
            <ion-icon slot="end" name="mail-outline" class="input-icon-enhanced"></ion-icon>
          </ion-item>
          <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('email')?.hasError('required') && counsellorForm.get('email')?.touched">
            Email is required
          </ion-note>
          <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('email')?.hasError('email') && counsellorForm.get('email')?.touched">
            Please enter a valid email address
          </ion-note>
        </div>

        <!-- Phone Full Width -->
        <div class="form-group-enhanced">
          <label class="form-label-enhanced">Phone Number *</label>
          <ion-item class="form-item-enhanced" [class.ion-invalid]="counsellorForm.get('phone_number')?.invalid && counsellorForm.get('phone_number')?.touched">
            <ion-input 
              formControlName="phone_number" 
              type="tel" 
              inputmode="tel" 
              placeholder="e.g., +919876543210" 
              required 
              (ionInput)="onPhoneNumberInput($event)" 
              maxlength="15"
            ></ion-input>
            <ion-icon slot="end" name="call-outline" class="input-icon-enhanced"></ion-icon>
          </ion-item>
          <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('phone_number')?.hasError('required') && counsellorForm.get('phone_number')?.touched">
            Phone number is required
          </ion-note>
          <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('phone_number')?.hasError('pattern') && counsellorForm.get('phone_number')?.touched">
            Please enter a valid phone number
          </ion-note>
        </div>

        <!-- Password Row -->
        <div class="form-row-enhanced">
          <div class="form-group-enhanced">
            <label class="form-label-enhanced">Password *</label>
            <ion-item class="form-item-enhanced" [class.ion-invalid]="counsellorForm.get('password')?.invalid && counsellorForm.get('password')?.touched">
              <ion-input 
                formControlName="password" 
                [type]="showPassword ? 'text' : 'password'" 
                placeholder="Enter password" 
                required 
                maxlength="10"
              ></ion-input>
              <ion-icon 
                slot="end" 
                [name]="showPassword ? 'eye-off-outline' : 'eye-outline'" 
                (click)="togglePasswordVisibility()"
                class="password-toggle-enhanced"
              ></ion-icon>
            </ion-item>
            <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('password')?.hasError('required') && counsellorForm.get('password')?.touched">
              Password is required
            </ion-note>
            <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('password')?.hasError('minlength') && counsellorForm.get('password')?.touched">
              Password must be at least 8 characters
            </ion-note>
          </div>

          <div class="form-group-enhanced">
            <label class="form-label-enhanced">Confirm Password *</label>
            <ion-item class="form-item-enhanced" [class.ion-invalid]="counsellorForm.get('confirm_password')?.invalid && counsellorForm.get('confirm_password')?.touched">
              <ion-input 
                formControlName="confirm_password" 
                [type]="showConfirmPassword ? 'text' : 'password'" 
                placeholder="Confirm password" 
                required
              ></ion-input>
              <ion-icon 
                slot="end" 
                [name]="showConfirmPassword ? 'eye-off-outline' : 'eye-outline'" 
                (click)="toggleConfirmPasswordVisibility()"
                class="password-toggle-enhanced"
              ></ion-icon>
            </ion-item>
            <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('confirm_password')?.hasError('required') && counsellorForm.get('confirm_password')?.touched">
              Confirm Password is required
            </ion-note>
            <ion-note class="error-note-enhanced" color="danger" *ngIf="counsellorForm.get('confirm_password')?.hasError('passwordMismatch') && counsellorForm.get('confirm_password')?.touched">
              Passwords do not match
            </ion-note>
          </div>
        </div>
      </div>

      <!-- Enhanced Form Actions -->
      <div class="form-actions-enhanced">
        <ion-button 
          type="submit" 
          class="submit-btn-enhanced"
          [disabled]="!counsellorForm.valid"
          expand="block"
          fill="solid"
        >
          <ion-spinner *ngIf="isLoading" name="crescent" class="loading-spinner-enhanced"></ion-spinner>
          <ion-icon *ngIf="!isLoading" name="person-add-outline" slot="start"></ion-icon>
          <span *ngIf="!isLoading">Create Account</span>
        </ion-button>
      </div>
    </form>

    <!-- Enhanced Footer -->
    <div class="footer-enhanced">
      <div class="divider-enhanced"></div>
      <p class="footer-text-enhanced">
        Already have an account? 
        <a (click)="navigateToLogin()" class="footer-link-enhanced">Sign in here</a>
      </p>
    </div>
  </div>
</ion-content>